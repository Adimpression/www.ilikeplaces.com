<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<LINK REL=STYLESHEET TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">
<META NAME="GENERATOR" CONTENT="Java2HTML Version 1.5">
<TITLE>ai.ilikeplaces.servlets.AbstractOAuth (Java2HTML)</TITLE>
</HEAD>
<BODY><TABLE id="Header" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2" width="33%">&nbsp;</td>
<td align="center" colspan="2" width="33%">
<font size="4">AbstractOAuth.java</font>
</td>
<td align="right" colspan="2" width="33%">&nbsp;</td>
</tr>
</TABLE>
<pre ID="Classes">
<A NAME="1"></A><FONT ID="Package">package</FONT> ai.ilikeplaces.servlets;
<A NAME="2"></A>
<A NAME="3"></A><FONT ID="Import">import</FONT> ai.ilikeplaces.doc.DOCUMENTATION;
<A NAME="4"></A><FONT ID="Import">import</FONT> ai.ilikeplaces.doc.LOGIC;
<A NAME="5"></A><FONT ID="Import">import</FONT> ai.ilikeplaces.doc.NOTE;
<A NAME="6"></A><FONT ID="Import">import</FONT> <A HREF="../../../ai/ilikeplaces/util/Loggers.java.html">ai.ilikeplaces.util.Loggers</A>;
<A NAME="7"></A><FONT ID="Import">import</FONT> <A HREF="../../../ai/ilikeplaces/util/Parameter.java.html">ai.ilikeplaces.util.Parameter</A>;
<A NAME="8"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.Header;
<A NAME="9"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.HttpClient;
<A NAME="10"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.HttpStatus;
<A NAME="11"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.MultiThreadedHttpConnectionManager;
<A NAME="12"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.methods.GetMethod;
<A NAME="13"></A><FONT ID="Import">import</FONT> org.apache.commons.httpclient.methods.PostMethod;
<A NAME="14"></A><FONT ID="Import">import</FONT> org.json.JSONException;
<A NAME="15"></A><FONT ID="Import">import</FONT> org.json.JSONObject;
<A NAME="16"></A>
<A NAME="17"></A><FONT ID="Import">import</FONT> javax.servlet.ServletException;
<A NAME="18"></A><FONT ID="Import">import</FONT> javax.servlet.http.HttpServlet;
<A NAME="19"></A><FONT ID="Import">import</FONT> javax.servlet.http.HttpServletRequest;
<A NAME="20"></A><FONT ID="Import">import</FONT> javax.servlet.http.HttpServletResponse;
<A NAME="21"></A><FONT ID="Import">import</FONT> java.io.BufferedReader;
<A NAME="22"></A><FONT ID="Import">import</FONT> java.io.IOException;
<A NAME="23"></A><FONT ID="Import">import</FONT> java.io.InputStream;
<A NAME="24"></A><FONT ID="Import">import</FONT> java.io.InputStreamReader;
<A NAME="25"></A><FONT ID="Import">import</FONT> java.util.Arrays;
<A NAME="26"></A><FONT ID="Import">import</FONT> java.util.HashMap;
<A NAME="27"></A><FONT ID="Import">import</FONT> java.util.Map;
<A NAME="28"></A>
<A NAME="29"></A><FONT ID="FormalComment">/**
<A NAME="30"></A> * Created by IntelliJ IDEA.
<A NAME="31"></A> * User: Ravindranath Akila
<A NAME="32"></A> * Date: 1/7/12
<A NAME="33"></A> * Time: 10:52 AM
<A NAME="34"></A> */</FONT>
<A NAME="35"></A>@DOCUMENTATION(
<A NAME="36"></A>        NOTE = @NOTE(
<A NAME="37"></A>                <FONT ID="StringLiteral">"This class was specifically designed to be vendor independent."</FONT> +
<A NAME="38"></A>                        <FONT ID="StringLiteral">"Much effort was made to build it by looking at http://tools.ietf.org/html/draft-ietf-oauth-v2 . "</FONT> +
<A NAME="39"></A>                        <FONT ID="StringLiteral">"Please immediately report any bugs you find at https://www.pivotaltracker.com/projects/304913 . "</FONT> +
<A NAME="40"></A>                        <FONT ID="StringLiteral">"Thank you!"</FONT>),
<A NAME="41"></A>        LOGIC = @LOGIC(
<A NAME="42"></A>                @NOTE(<FONT ID="StringLiteral">"A servlet is a shared resource."</FONT> +
<A NAME="43"></A>                        <FONT ID="StringLiteral">"Hence this class can contain only shared details of a the application as a client. "</FONT> +
<A NAME="44"></A>                        <FONT ID="StringLiteral">"It shall under no circumstance, contain data related to a specific user."</FONT> +
<A NAME="45"></A>                        <FONT ID="StringLiteral">"Since it is abstract, this class however, can have data related to a specific OAuth facilitator such as Facebook, Twitter and Google "</FONT> +
<A NAME="46"></A>                        <FONT ID="StringLiteral">"as each new instance with be created for that specific vendor and shared within that pool (logical pool).  "</FONT>)))
<A NAME="47"></A><FONT ID="Public">public</FONT> <FONT ID="Abstract">abstract</FONT> <FONT ID="Class">class</FONT> AbstractOAuth <FONT ID="Extends">extends</FONT> HttpServlet {
<A NAME="48"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS ------------------------------
<A NAME="49"></A></FONT>
<A NAME="50"></A>    <FONT ID="SingleLineComment">// ------------------------------ FIELDS STATIC --------------------------
<A NAME="51"></A></FONT>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> RuntimeException RedirectToOAuthEndpointFailed = <FONT ID="New">new</FONT> RuntimeException(<FONT ID="StringLiteral">"Redirect to OAuth Endpoint Failed!"</FONT>);
<A NAME="52"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String code = <FONT ID="StringLiteral">"code"</FONT>;
<A NAME="53"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String redirect_uri = <FONT ID="StringLiteral">"redirect_uri"</FONT>;
<A NAME="54"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String client_secret = <FONT ID="StringLiteral">"client_secret"</FONT>;
<A NAME="55"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String client_id = <FONT ID="StringLiteral">"client_id"</FONT>;
<A NAME="56"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String response_type = <FONT ID="StringLiteral">"response_type"</FONT>;
<A NAME="57"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String scope = <FONT ID="StringLiteral">"scope"</FONT>;
<A NAME="58"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String state = <FONT ID="StringLiteral">"state"</FONT>;
<A NAME="59"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String access_token = <FONT ID="StringLiteral">"access_token"</FONT>;
<A NAME="60"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String expires_in = <FONT ID="StringLiteral">"expires_in"</FONT>;
<A NAME="61"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String refresh_token = <FONT ID="StringLiteral">"refresh_token"</FONT>;
<A NAME="62"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String parameters = <FONT ID="StringLiteral">"parameters"</FONT>;
<A NAME="63"></A>    <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String token_type = <FONT ID="StringLiteral">"token_type"</FONT>;
<A NAME="64"></A>
<A NAME="65"></A>
<A NAME="66"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String QUESTION_MARK = <FONT ID="StringLiteral">"?"</FONT>;
<A NAME="67"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String GOT_ERROR_CODE = <FONT ID="StringLiteral">"Got error code:"</FONT>;
<A NAME="68"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String DOT_JASON = <FONT ID="StringLiteral">".json"</FONT>;
<A NAME="69"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String EQUALS = <FONT ID="StringLiteral">"="</FONT>;
<A NAME="70"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String API_KEY = <FONT ID="StringLiteral">"key"</FONT> + EQUALS;
<A NAME="71"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String AMPERSAND = <FONT ID="StringLiteral">"&amp;"</FONT>;
<A NAME="72"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String OPEN_SQR_BRCKT = <FONT ID="StringLiteral">"["</FONT>;
<A NAME="73"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String CLOSE_SQR_BRCKT = <FONT ID="StringLiteral">"]"</FONT>;
<A NAME="74"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String EMPTY = <FONT ID="StringLiteral">""</FONT>;
<A NAME="75"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String expires = <FONT ID="StringLiteral">"expires"</FONT>;
<A NAME="76"></A>    <FONT ID="Private">private</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String COMMA = <FONT ID="StringLiteral">","</FONT>;
<A NAME="77"></A>    <FONT ID="Public">public</FONT> <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> String ILP_DESTINATION = <FONT ID="StringLiteral">"ilp_destination"</FONT>;
<A NAME="78"></A>
<A NAME="79"></A>
<A NAME="80"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="81"></A></FONT>
<A NAME="82"></A>
<A NAME="83"></A>    <FONT ID="Final">final</FONT> OAuthAuthorizationRequest oAuthAuthorizationRequest;
<A NAME="84"></A>    <FONT ID="Final">final</FONT> String oAuthEndpoint;
<A NAME="85"></A>    <FONT ID="Final">final</FONT> String oAuthAuthorizationEndpoint;
<A NAME="86"></A>
<A NAME="87"></A>    <FONT ID="FormalComment">/**
<A NAME="88"></A>     * @see &lt;a href='http://hc.apache.org/httpclient-3.x/threading.html'&gt;httpclient threading&lt;/a&gt;
<A NAME="89"></A>     */</FONT>
<A NAME="90"></A>    <FONT ID="Private">private</FONT> <FONT ID="Final">final</FONT> HttpClient threadSafeHttpClient;
<A NAME="91"></A>    <FONT ID="Private">private</FONT> String api_key;
<A NAME="92"></A>    <FONT ID="Private">private</FONT> String jsonEndpoint;
<A NAME="93"></A>
<A NAME="94"></A><FONT ID="SingleLineComment">// --------------------------- CONSTRUCTORS ---------------------------
<A NAME="95"></A></FONT>
<A NAME="96"></A>    <FONT ID="FormalComment">/**
<A NAME="97"></A>     * 4.1.1.  Authorization Request
<A NAME="98"></A>     * &lt;p/&gt;
<A NAME="99"></A>     * &lt;p/&gt;
<A NAME="100"></A>     * The client constructs the request URI by adding the following
<A NAME="101"></A>     * parameters to the query component of the authorization oAuthEndpoint URI
<A NAME="102"></A>     * using the "application/x-www-form-urlencoded" format as defined by
<A NAME="103"></A>     * [W3C.REC-html401-19991224]:
<A NAME="104"></A>     * &lt;p/&gt;
<A NAME="105"></A>     * &lt;p/&gt;
<A NAME="106"></A>     * &lt;b&gt;response_type&lt;/b&gt;
<A NAME="107"></A>     * &lt;p/&gt;
<A NAME="108"></A>     * REQUIRED.  Value MUST be set to "code".
<A NAME="109"></A>     * &lt;p/&gt;
<A NAME="110"></A>     * &lt;b&gt;client_id&lt;/b&gt;
<A NAME="111"></A>     * &lt;p/&gt;
<A NAME="112"></A>     * REQUIRED.  The client identifier as described in Section 2.2.
<A NAME="113"></A>     * &lt;p/&gt;
<A NAME="114"></A>     * &lt;b&gt;redirect_uri&lt;/b&gt;
<A NAME="115"></A>     * &lt;p/&gt;
<A NAME="116"></A>     * OPTIONAL, as described in Section 3.1.2.
<A NAME="117"></A>     * &lt;p/&gt;
<A NAME="118"></A>     * &lt;b&gt;scope&lt;/b&gt;
<A NAME="119"></A>     * &lt;p/&gt;
<A NAME="120"></A>     * OPTIONAL.  The scope of the access request as described by
<A NAME="121"></A>     * Section 3.3.
<A NAME="122"></A>     * &lt;p/&gt;
<A NAME="123"></A>     * &lt;b&gt;state&lt;/b&gt;
<A NAME="124"></A>     * &lt;p/&gt;
<A NAME="125"></A>     * RECOMMENDED.  An opaque value used by the client to maintain
<A NAME="126"></A>     * state between the request and callback.  The authorization
<A NAME="127"></A>     * server includes this value when redirecting the user-agent back
<A NAME="128"></A>     * to the client.  The parameter SHOULD be used for preventing
<A NAME="129"></A>     * cross-site request forgery as described in Section 10.12.
<A NAME="130"></A>     * &lt;p/&gt;
<A NAME="131"></A>     * &lt;p/&gt;
<A NAME="132"></A>     * The client directs the resource owner to the constructed URI using an
<A NAME="133"></A>     * HTTP redirection response, or by other means available to it via the
<A NAME="134"></A>     * user-agent.
<A NAME="135"></A>     * &lt;p/&gt;
<A NAME="136"></A>     * For example, the client directs the user-agent to make the following
<A NAME="137"></A>     * HTTP request using transport-layer security (extra line breaks are
<A NAME="138"></A>     * for display purposes only):
<A NAME="139"></A>     * &lt;p/&gt;
<A NAME="140"></A>     * &lt;p/&gt;
<A NAME="141"></A>     * GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz
<A NAME="142"></A>     * &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
<A NAME="143"></A>     * &lt;p/&gt;
<A NAME="144"></A>     * Host: server.example.com
<A NAME="145"></A>     */</FONT>
<A NAME="146"></A>    @LOGIC(
<A NAME="147"></A>            @NOTE(<FONT ID="StringLiteral">"Here our main focus ist to initialize data related to "</FONT> +
<A NAME="148"></A>                    <FONT ID="StringLiteral">"&lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-22#section-4.1.1'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-22#section-4.1.1&lt;/a&gt; . "</FONT>))
<A NAME="149"></A>    <FONT ID="Public">public</FONT> AbstractOAuth() {
<A NAME="150"></A>        <FONT ID="This">this</FONT>.oAuthEndpoint = oAuthProvider().oAuthEndpoint;
<A NAME="151"></A>        <FONT ID="This">this</FONT>.oAuthAuthorizationEndpoint = oAuthProvider().oAuthAuthorizationEndpoint;
<A NAME="152"></A>        <FONT ID="This">this</FONT>.oAuthAuthorizationRequest = oAuthProvider().oAuthAuthorizationRequest;
<A NAME="153"></A>        <FONT ID="Final">final</FONT> MultiThreadedHttpConnectionManager connectionManager = <FONT ID="New">new</FONT> MultiThreadedHttpConnectionManager();
<A NAME="154"></A>        threadSafeHttpClient = <FONT ID="New">new</FONT> HttpClient(connectionManager);
<A NAME="155"></A>    }
<A NAME="156"></A>
<A NAME="157"></A>    <FONT ID="Abstract">abstract</FONT> OAuthProvider oAuthProvider();
<A NAME="158"></A>
<A NAME="159"></A><FONT ID="SingleLineComment">// ------------------------ CANONICAL METHODS ------------------------
<A NAME="160"></A></FONT>
<A NAME="161"></A>
<A NAME="162"></A><FONT ID="SingleLineComment">// -------------------------- OTHER METHODS --------------------------
<A NAME="163"></A></FONT>
<A NAME="164"></A>    <FONT ID="FormalComment">/**
<A NAME="165"></A>     * @param endpointEndValue
<A NAME="166"></A>     * @param parameters
<A NAME="167"></A>     * @return
<A NAME="168"></A>     */</FONT>
<A NAME="169"></A>    <FONT ID="Public">public</FONT> JSONObject getHttpContentAsJson(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> Map&lt;String, String&gt; parameters) {
<A NAME="170"></A>        <FONT ID="Final">final</FONT> StringBuilder sb = <FONT ID="New">new</FONT> StringBuilder(EMPTY);
<A NAME="171"></A>        <FONT ID="For">for</FONT> (<FONT ID="Final">final</FONT> String key : parameters.keySet()) {
<A NAME="172"></A>            sb.append(AMPERSAND).append(key).append(EQUALS).append(parameters.get(key));
<A NAME="173"></A>        }
<A NAME="174"></A>
<A NAME="175"></A>        JSONObject jsonObject;
<A NAME="176"></A>        <FONT ID="Try">try</FONT> {
<A NAME="177"></A>            jsonObject = <FONT ID="New">new</FONT> JSONObject(getHttpContent(endpointEndValue, sb.toString()));
<A NAME="178"></A>        } <FONT ID="Catch">catch</FONT> (JSONException e) {
<A NAME="179"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="180"></A>        }
<A NAME="181"></A>
<A NAME="182"></A>        <FONT ID="Return">return</FONT> jsonObject;
<A NAME="183"></A>    }
<A NAME="184"></A>
<A NAME="185"></A>
<A NAME="186"></A>    <FONT ID="FormalComment">/**
<A NAME="187"></A>     * @param endpointEndValue
<A NAME="188"></A>     * @param parameters
<A NAME="189"></A>     * @return
<A NAME="190"></A>     */</FONT>
<A NAME="191"></A>    <FONT ID="Public">public</FONT> JSONObject postHttpContentAsJson(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> Map&lt;String, String&gt; parameters) {
<A NAME="192"></A>        <FONT ID="Final">final</FONT> StringBuilder sb = <FONT ID="New">new</FONT> StringBuilder(EMPTY);
<A NAME="193"></A>        <FONT ID="For">for</FONT> (<FONT ID="Final">final</FONT> String key : parameters.keySet()) {
<A NAME="194"></A>            sb.append(AMPERSAND).append(key).append(EQUALS).append(parameters.get(key));
<A NAME="195"></A>        }
<A NAME="196"></A>
<A NAME="197"></A>        JSONObject jsonObject;
<A NAME="198"></A>        <FONT ID="Try">try</FONT> {
<A NAME="199"></A>            <FONT ID="Final">final</FONT> String response = postHttpContent(endpointEndValue, sb.toString());
<A NAME="200"></A>            Loggers.debug(response);
<A NAME="201"></A>            jsonObject = <FONT ID="New">new</FONT> JSONObject(response);
<A NAME="202"></A>        } <FONT ID="Catch">catch</FONT> (JSONException e) {
<A NAME="203"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="204"></A>        }
<A NAME="205"></A>
<A NAME="206"></A>        <FONT ID="Return">return</FONT> jsonObject;
<A NAME="207"></A>    }
<A NAME="208"></A>
<A NAME="209"></A>    <FONT ID="FormalComment">/**
<A NAME="210"></A>     * @param endpointEndValue
<A NAME="211"></A>     * @param optionalAppend   All strings in array will be concatenated and appended
<A NAME="212"></A>     * @return
<A NAME="213"></A>     */</FONT>
<A NAME="214"></A>    String getHttpContent(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> String... optionalAppend) {
<A NAME="215"></A>        <FONT ID="Final">final</FONT> String toBeCalled = endpointEndValue
<A NAME="216"></A>                + QUESTION_MARK
<A NAME="217"></A>                + ((optionalAppend != <FONT ID="Null">null</FONT> &amp;&amp; optionalAppend.length != <FONT ID="IntegerLiteral">0</FONT>) ? Arrays.toString(optionalAppend).replace(OPEN_SQR_BRCKT, EMPTY).replace(CLOSE_SQR_BRCKT, EMPTY) : EMPTY);
<A NAME="218"></A>
<A NAME="219"></A>        <FONT ID="Final">final</FONT> GetMethod getMethod = <FONT ID="New">new</FONT> GetMethod(toBeCalled);
<A NAME="220"></A>
<A NAME="221"></A>        <FONT ID="Int">int</FONT> statusCode = <FONT ID="IntegerLiteral">0</FONT>;
<A NAME="222"></A>        <FONT ID="Try">try</FONT> {
<A NAME="223"></A>            statusCode = threadSafeHttpClient.executeMethod(getMethod);
<A NAME="224"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> IOException e) {
<A NAME="225"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="226"></A>        }
<A NAME="227"></A>
<A NAME="228"></A>        <FONT ID="If">if</FONT> (statusCode != HttpStatus.SC_OK &amp;&amp; statusCode != HttpStatus.SC_MOVED_TEMPORARILY) {
<A NAME="229"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(GOT_ERROR_CODE + statusCode);
<A NAME="230"></A>        }
<A NAME="231"></A>        InputStream inputStream = <FONT ID="Null">null</FONT>;
<A NAME="232"></A>
<A NAME="233"></A>        <FONT ID="Try">try</FONT> {
<A NAME="234"></A>            inputStream = getMethod.getResponseBodyAsStream();
<A NAME="235"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="236"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="237"></A>        }
<A NAME="238"></A>
<A NAME="239"></A>        <FONT ID="Final">final</FONT> BufferedReader br = <FONT ID="New">new</FONT> BufferedReader(<FONT ID="New">new</FONT> InputStreamReader(inputStream));
<A NAME="240"></A>        String line;
<A NAME="241"></A>        String accumulator = EMPTY;
<A NAME="242"></A>        <FONT ID="Try">try</FONT> {
<A NAME="243"></A>            <FONT ID="While">while</FONT> ((line = br.readLine()) != <FONT ID="Null">null</FONT>) {
<A NAME="244"></A>                accumulator += line;
<A NAME="245"></A>            }
<A NAME="246"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="247"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="248"></A>        }
<A NAME="249"></A>        <FONT ID="Try">try</FONT> {
<A NAME="250"></A>            br.close();
<A NAME="251"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="252"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="253"></A>        }
<A NAME="254"></A>        <FONT ID="Return">return</FONT> accumulator;
<A NAME="255"></A>    }
<A NAME="256"></A>
<A NAME="257"></A>    <FONT ID="FormalComment">/**
<A NAME="258"></A>     * @param endpointEndValue
<A NAME="259"></A>     * @param optionalAppend   All strings in array will be concatenated and appended
<A NAME="260"></A>     * @return
<A NAME="261"></A>     */</FONT>
<A NAME="262"></A>    String postHttpContent(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> String... optionalAppend) {
<A NAME="263"></A>        <FONT ID="Final">final</FONT> String toBeCalled = endpointEndValue
<A NAME="264"></A>                + QUESTION_MARK
<A NAME="265"></A>                + ((optionalAppend != <FONT ID="Null">null</FONT> &amp;&amp; optionalAppend.length != <FONT ID="IntegerLiteral">0</FONT>) ? Arrays.toString(optionalAppend).replace(OPEN_SQR_BRCKT, EMPTY).replace(CLOSE_SQR_BRCKT, EMPTY) : EMPTY);
<A NAME="266"></A>
<A NAME="267"></A>        <FONT ID="Final">final</FONT> PostMethod getMethod = <FONT ID="New">new</FONT> PostMethod(toBeCalled);
<A NAME="268"></A>
<A NAME="269"></A>        <FONT ID="Int">int</FONT> statusCode = <FONT ID="IntegerLiteral">0</FONT>;
<A NAME="270"></A>        <FONT ID="Try">try</FONT> {
<A NAME="271"></A>            statusCode = threadSafeHttpClient.executeMethod(getMethod);
<A NAME="272"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> IOException e) {
<A NAME="273"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="274"></A>        }
<A NAME="275"></A>
<A NAME="276"></A>        <FONT ID="If">if</FONT> (statusCode != HttpStatus.SC_OK &amp;&amp; statusCode != HttpStatus.SC_MOVED_TEMPORARILY) {
<A NAME="277"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(GOT_ERROR_CODE + statusCode);
<A NAME="278"></A>        }
<A NAME="279"></A>        InputStream inputStream = <FONT ID="Null">null</FONT>;
<A NAME="280"></A>
<A NAME="281"></A>        <FONT ID="Try">try</FONT> {
<A NAME="282"></A>            inputStream = getMethod.getResponseBodyAsStream();
<A NAME="283"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="284"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="285"></A>        }
<A NAME="286"></A>
<A NAME="287"></A>        <FONT ID="Final">final</FONT> BufferedReader br = <FONT ID="New">new</FONT> BufferedReader(<FONT ID="New">new</FONT> InputStreamReader(inputStream));
<A NAME="288"></A>        String line;
<A NAME="289"></A>        String accumulator = EMPTY;
<A NAME="290"></A>        <FONT ID="Try">try</FONT> {
<A NAME="291"></A>            <FONT ID="While">while</FONT> ((line = br.readLine()) != <FONT ID="Null">null</FONT>) {
<A NAME="292"></A>                accumulator += line;
<A NAME="293"></A>            }
<A NAME="294"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="295"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="296"></A>        }
<A NAME="297"></A>        <FONT ID="Try">try</FONT> {
<A NAME="298"></A>            br.close();
<A NAME="299"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="300"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="301"></A>        }
<A NAME="302"></A>        <FONT ID="Return">return</FONT> accumulator;
<A NAME="303"></A>    }
<A NAME="304"></A>
<A NAME="305"></A>    <FONT ID="FormalComment">/**
<A NAME="306"></A>     * @param endpointEndValue
<A NAME="307"></A>     * @param headerName
<A NAME="308"></A>     * @param optionalAppend   All strings in array will be concatenated and appended
<A NAME="309"></A>     * @return
<A NAME="310"></A>     */</FONT>
<A NAME="311"></A>    Header getHttpHeader(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> String headerName, <FONT ID="Final">final</FONT> String... optionalAppend) {
<A NAME="312"></A>        <FONT ID="Final">final</FONT> String toBeCalled = jsonEndpoint + endpointEndValue
<A NAME="313"></A>                + QUESTION_MARK
<A NAME="314"></A>                + ((optionalAppend != <FONT ID="Null">null</FONT> &amp;&amp; optionalAppend.length != <FONT ID="IntegerLiteral">0</FONT>) ? Arrays.toString(optionalAppend).replace(OPEN_SQR_BRCKT, EMPTY).replace(CLOSE_SQR_BRCKT, EMPTY) : EMPTY);
<A NAME="315"></A>
<A NAME="316"></A>
<A NAME="317"></A>        <FONT ID="Final">final</FONT> GetMethod getMethod = <FONT ID="New">new</FONT> GetMethod(toBeCalled);
<A NAME="318"></A>
<A NAME="319"></A>        <FONT ID="Int">int</FONT> statusCode = <FONT ID="IntegerLiteral">0</FONT>;
<A NAME="320"></A>        <FONT ID="Try">try</FONT> {
<A NAME="321"></A>            statusCode = threadSafeHttpClient.executeMethod(getMethod);
<A NAME="322"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> IOException e) {
<A NAME="323"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="324"></A>        }
<A NAME="325"></A>
<A NAME="326"></A>        <FONT ID="If">if</FONT> (statusCode != HttpStatus.SC_OK &amp;&amp; statusCode != HttpStatus.SC_MOVED_TEMPORARILY) {
<A NAME="327"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(GOT_ERROR_CODE + statusCode);
<A NAME="328"></A>        }
<A NAME="329"></A>
<A NAME="330"></A>        <FONT ID="Return">return</FONT> getMethod.getRequestHeader(headerName);
<A NAME="331"></A>    }
<A NAME="332"></A>
<A NAME="333"></A>    <FONT ID="FormalComment">/**
<A NAME="334"></A>     * Only supports format: application/x-www-form-urlencoded
<A NAME="335"></A>     *
<A NAME="336"></A>     * @param oAuthAuthorizationResponse
<A NAME="337"></A>     * @param clientAuthentication
<A NAME="338"></A>     * @return
<A NAME="339"></A>     * @see &lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2&lt;/a&gt;
<A NAME="340"></A>     */</FONT>
<A NAME="341"></A>    OAuthAccessTokenResponse getOAuthAccessTokenResponse(<FONT ID="Final">final</FONT> OAuthAuthorizationResponse oAuthAuthorizationResponse, <FONT ID="Final">final</FONT> ClientAuthentication clientAuthentication) {
<A NAME="342"></A>        <FONT ID="SingleLineComment">//Last time we checked, this did now work. 
<A NAME="343"></A></FONT>        <FONT ID="MultiLineComment">/*final Header[] oAuthAccessTokenResponseHeaders = getHttpHeaders(
<A NAME="344"></A>                oAuthAuthorizationEndpoint,
<A NAME="345"></A>                new Parameter()
<A NAME="346"></A>                        .append(code, oAuthAuthorizationResponse.code)
<A NAME="347"></A>                        .append(client_id, clientAuthentication.client_id)
<A NAME="348"></A>                        .append(client_secret, clientAuthentication.client_secret)
<A NAME="349"></A>                        .append(redirect_uri, "http://www.ilikeplaces.com/oauth2")
<A NAME="350"></A>                        .get()
<A NAME="351"></A>        );  */</FONT>
<A NAME="352"></A>
<A NAME="353"></A>        <FONT ID="Final">final</FONT> String access_token_string = getHttpContent(
<A NAME="354"></A>                oAuthAuthorizationEndpoint,
<A NAME="355"></A>                <FONT ID="New">new</FONT> <A HREF="../../../ai/ilikeplaces/util/Parameter.java.html">Parameter</A>()
<A NAME="356"></A>                        .append(code, oAuthAuthorizationResponse.code)
<A NAME="357"></A>                        .append(client_id, clientAuthentication.client_id)
<A NAME="358"></A>                        .append(redirect_uri, clientAuthentication.redirect_uri)
<A NAME="359"></A>                        .append(client_secret, clientAuthentication.client_secret)
<A NAME="360"></A>                        .get()
<A NAME="361"></A>        );
<A NAME="362"></A>
<A NAME="363"></A>        String name;
<A NAME="364"></A>        String value;
<A NAME="365"></A>
<A NAME="366"></A>        String access_token_value = AbstractOAuth.EMPTY;
<A NAME="367"></A>
<A NAME="368"></A>        String token_type_value = AbstractOAuth.EMPTY;
<A NAME="369"></A>
<A NAME="370"></A>        String expires_in_value = AbstractOAuth.EMPTY;
<A NAME="371"></A>
<A NAME="372"></A>        String refresh_token_value = AbstractOAuth.EMPTY;
<A NAME="373"></A>
<A NAME="374"></A>        String parameters_value = AbstractOAuth.EMPTY;
<A NAME="375"></A>
<A NAME="376"></A>        <FONT ID="For">for</FONT> (<FONT ID="Final">final</FONT> String key_value : access_token_string.split(<FONT ID="StringLiteral">"&amp;"</FONT>)) {
<A NAME="377"></A>
<A NAME="378"></A>            <FONT ID="Final">final</FONT> String[] split = key_value.split(<FONT ID="StringLiteral">"="</FONT>);
<A NAME="379"></A>            name = split[<FONT ID="IntegerLiteral">0</FONT>];
<A NAME="380"></A>            value = split[<FONT ID="IntegerLiteral">1</FONT>];
<A NAME="381"></A>
<A NAME="382"></A>            Loggers.debug(name + COMMA + value);
<A NAME="383"></A>
<A NAME="384"></A>            <FONT ID="If">if</FONT> (name.equals(access_token)) {
<A NAME="385"></A>                access_token_value = value;
<A NAME="386"></A>                <FONT ID="Continue">continue</FONT>;
<A NAME="387"></A>            }
<A NAME="388"></A>            <FONT ID="If">if</FONT> (name.equals(token_type)) {
<A NAME="389"></A>                token_type_value = value;
<A NAME="390"></A>                <FONT ID="Continue">continue</FONT>;
<A NAME="391"></A>            }
<A NAME="392"></A>            <FONT ID="If">if</FONT> (name.equals(expires_in) || <FONT ID="MultiLineComment">/*I know. Facebook!!!*/</FONT>name.equals(expires)) {
<A NAME="393"></A>                expires_in_value = value;
<A NAME="394"></A>                <FONT ID="Continue">continue</FONT>;
<A NAME="395"></A>            }
<A NAME="396"></A>            <FONT ID="If">if</FONT> (name.equals(refresh_token)) {
<A NAME="397"></A>                refresh_token_value = value;
<A NAME="398"></A>                <FONT ID="Continue">continue</FONT>;
<A NAME="399"></A>            }
<A NAME="400"></A>            <FONT ID="If">if</FONT> (name.equals(parameters)) {
<A NAME="401"></A>                parameters_value = value;
<A NAME="402"></A>                <FONT ID="Continue">continue</FONT>;
<A NAME="403"></A>            }
<A NAME="404"></A>        }
<A NAME="405"></A>
<A NAME="406"></A>        <FONT ID="Return">return</FONT> <FONT ID="New">new</FONT> OAuthAccessTokenResponse(access_token_value, token_type_value, expires_in_value, refresh_token_value, parameters_value);
<A NAME="407"></A>    }
<A NAME="408"></A>
<A NAME="409"></A>    <FONT ID="FormalComment">/**
<A NAME="410"></A>     * Only supports format: application/x-www-form-urlencoded
<A NAME="411"></A>     *
<A NAME="412"></A>     * @param oAuthAuthorizationResponse
<A NAME="413"></A>     * @param clientAuthentication
<A NAME="414"></A>     * @return
<A NAME="415"></A>     * @see &lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2&lt;/a&gt;
<A NAME="416"></A>     */</FONT>
<A NAME="417"></A>
<A NAME="418"></A>    OAuthAccessTokenResponse getOAuthAccessTokenResponseUsingJson(<FONT ID="Final">final</FONT> OAuthAuthorizationResponse oAuthAuthorizationResponse, <FONT ID="Final">final</FONT> ClientAuthentication clientAuthentication) {
<A NAME="419"></A>
<A NAME="420"></A>        <FONT ID="Final">final</FONT> JSONObject access_token_string = postHttpContentAsJson(oAuthAuthorizationEndpoint,
<A NAME="421"></A>                <FONT ID="New">new</FONT> HashMap&lt;String, String&gt;() {
<A NAME="422"></A>                    {
<A NAME="423"></A>                        put(code, oAuthAuthorizationResponse.code);
<A NAME="424"></A>                        put(client_id, clientAuthentication.client_id);
<A NAME="425"></A>                        put(redirect_uri, clientAuthentication.redirect_uri);
<A NAME="426"></A>                        put(client_secret, clientAuthentication.client_secret);
<A NAME="427"></A>                        put(<FONT ID="StringLiteral">"grant_type"</FONT>, <FONT ID="StringLiteral">"authorization_code"</FONT>);
<A NAME="428"></A>                    }
<A NAME="429"></A>                });
<A NAME="430"></A>
<A NAME="431"></A>
<A NAME="432"></A>        String access_token_value = AbstractOAuth.EMPTY;
<A NAME="433"></A>
<A NAME="434"></A>        String token_type_value = AbstractOAuth.EMPTY;
<A NAME="435"></A>
<A NAME="436"></A>        String expires_in_value = AbstractOAuth.EMPTY;
<A NAME="437"></A>
<A NAME="438"></A>        String refresh_token_value = AbstractOAuth.EMPTY;
<A NAME="439"></A>
<A NAME="440"></A>        String parameters_value = AbstractOAuth.EMPTY;
<A NAME="441"></A>
<A NAME="442"></A>
<A NAME="443"></A>        <FONT ID="Try">try</FONT> {
<A NAME="444"></A>            access_token_value = access_token_string.getString(access_token);
<A NAME="445"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> JSONException e) {
<A NAME="446"></A>            <FONT ID="SingleLineComment">//hell uf a world!
<A NAME="447"></A></FONT>        }
<A NAME="448"></A>
<A NAME="449"></A>        <FONT ID="Try">try</FONT> {
<A NAME="450"></A>            token_type_value = access_token_string.getString(token_type);
<A NAME="451"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> JSONException e) {
<A NAME="452"></A>            <FONT ID="SingleLineComment">//hell uf a world!
<A NAME="453"></A></FONT>        }
<A NAME="454"></A>
<A NAME="455"></A>        <FONT ID="Try">try</FONT> {
<A NAME="456"></A>            expires_in_value = access_token_string.getString(expires_in);
<A NAME="457"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> JSONException e) {
<A NAME="458"></A>            <FONT ID="SingleLineComment">//hell uf a world!
<A NAME="459"></A></FONT>        }
<A NAME="460"></A>
<A NAME="461"></A>        <FONT ID="Try">try</FONT> {
<A NAME="462"></A>            refresh_token_value = access_token_string.getString(refresh_token);
<A NAME="463"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> JSONException e) {
<A NAME="464"></A>            <FONT ID="SingleLineComment">//hell uf a world!
<A NAME="465"></A></FONT>        }
<A NAME="466"></A>
<A NAME="467"></A>        <FONT ID="Try">try</FONT> {
<A NAME="468"></A>            parameters_value = access_token_string.getString(parameters);
<A NAME="469"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> JSONException e) {
<A NAME="470"></A>            <FONT ID="SingleLineComment">//hell uf a world!
<A NAME="471"></A></FONT>        }
<A NAME="472"></A>
<A NAME="473"></A>
<A NAME="474"></A>        <FONT ID="Return">return</FONT> <FONT ID="New">new</FONT> OAuthAccessTokenResponse(access_token_value, token_type_value, expires_in_value, refresh_token_value, parameters_value);
<A NAME="475"></A>    }
<A NAME="476"></A>
<A NAME="477"></A>    <FONT ID="FormalComment">/**
<A NAME="478"></A>     * @param endpointEndValue
<A NAME="479"></A>     * @param optionalAppend   All strings in array will be concatenated and appended
<A NAME="480"></A>     * @return
<A NAME="481"></A>     */</FONT>
<A NAME="482"></A>    Header[] getHttpHeaders(<FONT ID="Final">final</FONT> String endpointEndValue, <FONT ID="Final">final</FONT> String... optionalAppend) {
<A NAME="483"></A>        <FONT ID="Final">final</FONT> String toBeCalled = endpointEndValue
<A NAME="484"></A>                + QUESTION_MARK
<A NAME="485"></A>                + ((optionalAppend != <FONT ID="Null">null</FONT> &amp;&amp; optionalAppend.length != <FONT ID="IntegerLiteral">0</FONT>) ? Arrays.toString(optionalAppend).replace(OPEN_SQR_BRCKT, EMPTY).replace(CLOSE_SQR_BRCKT, EMPTY) : EMPTY);
<A NAME="486"></A>
<A NAME="487"></A>
<A NAME="488"></A>        <FONT ID="Final">final</FONT> GetMethod getMethod = <FONT ID="New">new</FONT> GetMethod(toBeCalled);
<A NAME="489"></A>
<A NAME="490"></A>        <FONT ID="Int">int</FONT> statusCode = <FONT ID="IntegerLiteral">0</FONT>;
<A NAME="491"></A>        <FONT ID="Try">try</FONT> {
<A NAME="492"></A>            statusCode = threadSafeHttpClient.executeMethod(getMethod);
<A NAME="493"></A>        } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> IOException e) {
<A NAME="494"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(e);
<A NAME="495"></A>        }
<A NAME="496"></A>
<A NAME="497"></A>        <FONT ID="If">if</FONT> (statusCode != HttpStatus.SC_OK &amp;&amp; statusCode != HttpStatus.SC_MOVED_TEMPORARILY) {
<A NAME="498"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> RuntimeException(GOT_ERROR_CODE + statusCode);
<A NAME="499"></A>        }
<A NAME="500"></A>
<A NAME="501"></A>        <FONT ID="Return">return</FONT> getMethod.getRequestHeaders();
<A NAME="502"></A>    }
<A NAME="503"></A>
<A NAME="504"></A>    <FONT ID="FormalComment">/**
<A NAME="505"></A>     * @param request
<A NAME="506"></A>     * @param response
<A NAME="507"></A>     * @return OAuthAuthorizationResponse or redirects user to endpoint and returns null
<A NAME="508"></A>     */</FONT>
<A NAME="509"></A>    OAuthAuthorizationResponse getOAuthAuthorizationResponse(<FONT ID="Final">final</FONT> HttpServletRequest request, <FONT ID="Final">final</FONT> HttpServletResponse response) {
<A NAME="510"></A>        <FONT ID="Final">final</FONT> String code = request.getParameter(AbstractOAuth.code);
<A NAME="511"></A>        <FONT ID="Final">final</FONT> String state = request.getParameter(AbstractOAuth.state);
<A NAME="512"></A>
<A NAME="513"></A>        <FONT ID="If">if</FONT> (code == <FONT ID="Null">null</FONT> || code.isEmpty()) {
<A NAME="514"></A>            <FONT ID="Try">try</FONT> {
<A NAME="515"></A>                response.sendRedirect(
<A NAME="516"></A>                        <FONT ID="New">new</FONT> <A HREF="../../../ai/ilikeplaces/util/Parameter.java.html">Parameter</A>(<FONT ID="This">this</FONT>.oAuthEndpoint)
<A NAME="517"></A>                                .append(client_id, <FONT ID="This">this</FONT>.oAuthAuthorizationRequest.client_id, <FONT ID="True">true</FONT>)
<A NAME="518"></A>                                .append(redirect_uri, <FONT ID="This">this</FONT>.oAuthAuthorizationRequest.redirect_uri)
<A NAME="519"></A>                                .append(response_type, <FONT ID="This">this</FONT>.oAuthAuthorizationRequest.response_type)
<A NAME="520"></A>                                .append(scope, <FONT ID="This">this</FONT>.oAuthAuthorizationRequest.scope)
<A NAME="521"></A>                                .append(AbstractOAuth.state, <FONT ID="This">this</FONT>.oAuthAuthorizationRequest.state)
<A NAME="522"></A>                                .get()
<A NAME="523"></A>
<A NAME="524"></A>                );
<A NAME="525"></A>            } <FONT ID="Catch">catch</FONT> (<FONT ID="Final">final</FONT> IOException e) {
<A NAME="526"></A>                <FONT ID="SingleLineComment">//hmmm!
<A NAME="527"></A></FONT>                <FONT ID="Throw">throw</FONT> RedirectToOAuthEndpointFailed;
<A NAME="528"></A>            }
<A NAME="529"></A>            <FONT ID="Return">return</FONT> <FONT ID="Null">null</FONT>;
<A NAME="530"></A>        } <FONT ID="Else">else</FONT> {
<A NAME="531"></A>            <FONT ID="Return">return</FONT> <FONT ID="New">new</FONT> OAuthAuthorizationResponse(code, state);
<A NAME="532"></A>        }
<A NAME="533"></A>    }
<A NAME="534"></A>
<A NAME="535"></A><FONT ID="SingleLineComment">// -------------------------- INNER CLASSES --------------------------
<A NAME="536"></A></FONT>
<A NAME="537"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> OAuthProvider {
<A NAME="538"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS STATIC --------------------------
<A NAME="539"></A></FONT>
<A NAME="540"></A>
<A NAME="541"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="542"></A></FONT>
<A NAME="543"></A>
<A NAME="544"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> OAuthAuthorizationRequest oAuthAuthorizationRequest;
<A NAME="545"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> String oAuthEndpoint;
<A NAME="546"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> String oAuthAuthorizationEndpoint;
<A NAME="547"></A>
<A NAME="548"></A>        <FONT ID="FormalComment">/**
<A NAME="549"></A>         * @param oAuthEndpoint             Such as facebook - https://www.facebook.com/dialog/oauth
<A NAME="550"></A>         * @param oAuthAuthorizationRequest Contains requred parameters for the endpoint
<A NAME="551"></A>         */</FONT>
<A NAME="552"></A>        <FONT ID="Public">public</FONT> OAuthProvider(
<A NAME="553"></A>                <FONT ID="Final">final</FONT> String oAuthEndpoint,
<A NAME="554"></A>                <FONT ID="Final">final</FONT> String oAuthAuthorizationEndpoint,
<A NAME="555"></A>                <FONT ID="Final">final</FONT> OAuthAuthorizationRequest oAuthAuthorizationRequest) {
<A NAME="556"></A>            <FONT ID="This">this</FONT>.oAuthEndpoint = oAuthEndpoint;
<A NAME="557"></A>            <FONT ID="This">this</FONT>.oAuthAuthorizationEndpoint = oAuthAuthorizationEndpoint;
<A NAME="558"></A>            <FONT ID="This">this</FONT>.oAuthAuthorizationRequest = oAuthAuthorizationRequest;
<A NAME="559"></A>        }
<A NAME="560"></A>
<A NAME="561"></A>        @Override
<A NAME="562"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="563"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"OAuthProvider{"</FONT> +
<A NAME="564"></A>                    <FONT ID="StringLiteral">"oAuthAuthorizationRequest="</FONT> + oAuthAuthorizationRequest +
<A NAME="565"></A>                    <FONT ID="StringLiteral">", oAuthEndpoint='"</FONT> + oAuthEndpoint + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="566"></A>                    <FONT ID="StringLiteral">", oAuthAuthorizationEndpoint='"</FONT> + oAuthAuthorizationEndpoint + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="567"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="568"></A>        }
<A NAME="569"></A>    }
<A NAME="570"></A>
<A NAME="571"></A>    <FONT ID="FormalComment">/**
<A NAME="572"></A>     * * 4.1.1.  Authorization Request
<A NAME="573"></A>     * &lt;p/&gt;
<A NAME="574"></A>     * &lt;p/&gt;
<A NAME="575"></A>     * The client constructs the request URI by adding the following
<A NAME="576"></A>     * parameters to the query component of the authorization endpoint URI
<A NAME="577"></A>     * using the "application/x-www-form-urlencoded" format as defined by
<A NAME="578"></A>     * [W3C.REC-html401-19991224]:
<A NAME="579"></A>     * &lt;p/&gt;
<A NAME="580"></A>     * &lt;p/&gt;
<A NAME="581"></A>     * &lt;b&gt;response_type&lt;/b&gt;
<A NAME="582"></A>     * &lt;p/&gt;
<A NAME="583"></A>     * REQUIRED.  Value MUST be set to "code".
<A NAME="584"></A>     * &lt;p/&gt;
<A NAME="585"></A>     * &lt;b&gt;client_id&lt;/b&gt;
<A NAME="586"></A>     * &lt;p/&gt;
<A NAME="587"></A>     * REQUIRED.  The client identifier as described in Section 2.2.
<A NAME="588"></A>     * &lt;p/&gt;
<A NAME="589"></A>     * &lt;b&gt;redirect_uri&lt;/b&gt;
<A NAME="590"></A>     * &lt;p/&gt;
<A NAME="591"></A>     * OPTIONAL, as described in Section 3.1.2.
<A NAME="592"></A>     * &lt;p/&gt;
<A NAME="593"></A>     * &lt;b&gt;scope&lt;/b&gt;
<A NAME="594"></A>     * &lt;p/&gt;
<A NAME="595"></A>     * OPTIONAL.  The scope of the access request as described by
<A NAME="596"></A>     * Section 3.3.
<A NAME="597"></A>     * &lt;p/&gt;
<A NAME="598"></A>     * &lt;b&gt;state&lt;/b&gt;
<A NAME="599"></A>     * &lt;p/&gt;
<A NAME="600"></A>     * RECOMMENDED.  An opaque value used by the client to maintain
<A NAME="601"></A>     * state between the request and callback.  The authorization
<A NAME="602"></A>     * server includes this value when redirecting the user-agent back
<A NAME="603"></A>     * to the client.  The parameter SHOULD be used for preventing
<A NAME="604"></A>     * cross-site request forgery as described in Section 10.12.
<A NAME="605"></A>     * &lt;p/&gt;
<A NAME="606"></A>     * &lt;p/&gt;
<A NAME="607"></A>     * The client directs the resource owner to the constructed URI using an
<A NAME="608"></A>     * HTTP redirection response, or by other means available to it via the
<A NAME="609"></A>     * user-agent.
<A NAME="610"></A>     * &lt;p/&gt;
<A NAME="611"></A>     * For example, the client directs the user-agent to make the following
<A NAME="612"></A>     * HTTP request using transport-layer security (extra line breaks are
<A NAME="613"></A>     * for display purposes only):
<A NAME="614"></A>     * &lt;p/&gt;
<A NAME="615"></A>     * &lt;p/&gt;
<A NAME="616"></A>     * GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz
<A NAME="617"></A>     * &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
<A NAME="618"></A>     * &lt;p/&gt;
<A NAME="619"></A>     * Host: server.example.com
<A NAME="620"></A>     */</FONT>
<A NAME="621"></A>    @LOGIC(
<A NAME="622"></A>            @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="623"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> OAuthAuthorizationRequest {
<A NAME="624"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="625"></A></FONT>
<A NAME="626"></A>
<A NAME="627"></A>        <FONT ID="FormalComment">/**
<A NAME="628"></A>         * REQUIRED.  Value MUST be set to "code".
<A NAME="629"></A>         */</FONT>
<A NAME="630"></A>        <FONT ID="Final">final</FONT> String response_type;
<A NAME="631"></A>
<A NAME="632"></A>        <FONT ID="FormalComment">/**
<A NAME="633"></A>         * REQUIRED.  The client identifier as described in Section 2.2.
<A NAME="634"></A>         */</FONT>
<A NAME="635"></A>        <FONT ID="Final">final</FONT> String client_id;
<A NAME="636"></A>
<A NAME="637"></A>        <FONT ID="FormalComment">/**
<A NAME="638"></A>         * OPTIONAL, as described in Section 3.1.2.
<A NAME="639"></A>         */</FONT>
<A NAME="640"></A>        <FONT ID="Final">final</FONT> String redirect_uri;
<A NAME="641"></A>
<A NAME="642"></A>        <FONT ID="FormalComment">/**
<A NAME="643"></A>         * OPTIONAL.  The scope of the access request as described by
<A NAME="644"></A>         */</FONT>
<A NAME="645"></A>        <FONT ID="Final">final</FONT> String scope;
<A NAME="646"></A>
<A NAME="647"></A>        <FONT ID="FormalComment">/**
<A NAME="648"></A>         * RECOMMENDED.  An opaque value used by the client to maintain
<A NAME="649"></A>         * state between the request and callback.  The authorization
<A NAME="650"></A>         * server includes this value when redirecting the user-agent back
<A NAME="651"></A>         * to the client.  The parameter SHOULD be used for preventing
<A NAME="652"></A>         * cross-site request forgery as described in Section 10.12.
<A NAME="653"></A>         */</FONT>
<A NAME="654"></A>        <FONT ID="Final">final</FONT> String state;
<A NAME="655"></A>
<A NAME="656"></A>        @LOGIC(
<A NAME="657"></A>                @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="658"></A>        <FONT ID="Public">public</FONT> OAuthAuthorizationRequest(<FONT ID="Final">final</FONT> String response_type,
<A NAME="659"></A>                                         <FONT ID="Final">final</FONT> String client_id,
<A NAME="660"></A>                                         <FONT ID="Final">final</FONT> String redirect_uri,
<A NAME="661"></A>                                         <FONT ID="Final">final</FONT> String scope,
<A NAME="662"></A>                                         <FONT ID="Final">final</FONT> String state) {
<A NAME="663"></A>            <FONT ID="This">this</FONT>.response_type = response_type != <FONT ID="Null">null</FONT> ? response_type : AbstractOAuth.EMPTY;
<A NAME="664"></A>            <FONT ID="This">this</FONT>.client_id = client_id != <FONT ID="Null">null</FONT> ? client_id : AbstractOAuth.EMPTY;
<A NAME="665"></A>            <FONT ID="This">this</FONT>.redirect_uri = redirect_uri != <FONT ID="Null">null</FONT> ? redirect_uri : AbstractOAuth.EMPTY;
<A NAME="666"></A>            <FONT ID="This">this</FONT>.scope = scope != <FONT ID="Null">null</FONT> ? scope : AbstractOAuth.EMPTY;
<A NAME="667"></A>            <FONT ID="This">this</FONT>.state = state != <FONT ID="Null">null</FONT> ? state : AbstractOAuth.EMPTY;
<A NAME="668"></A>        }
<A NAME="669"></A>
<A NAME="670"></A>        @Override
<A NAME="671"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="672"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"OAuthAuthorizationRequest{"</FONT> +
<A NAME="673"></A>                    <FONT ID="StringLiteral">"response_type='"</FONT> + response_type + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="674"></A>                    <FONT ID="StringLiteral">", client_id='"</FONT> + client_id + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="675"></A>                    <FONT ID="StringLiteral">", redirect_uri='"</FONT> + redirect_uri + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="676"></A>                    <FONT ID="StringLiteral">", scope='"</FONT> + scope + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="677"></A>                    <FONT ID="StringLiteral">", state='"</FONT> + state + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="678"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="679"></A>        }
<A NAME="680"></A>    }
<A NAME="681"></A>
<A NAME="682"></A>    <FONT ID="FormalComment">/**
<A NAME="683"></A>     * If the resource owner grants the access request, the authorization
<A NAME="684"></A>     * server issues an authorization code and delivers it to the client by
<A NAME="685"></A>     * adding the following parameters to the query component of the
<A NAME="686"></A>     * redirection URI using the "application/x-www-form-urlencoded" format:
<A NAME="687"></A>     * &lt;p/&gt;
<A NAME="688"></A>     * code
<A NAME="689"></A>     * REQUIRED.  The authorization code generated by the
<A NAME="690"></A>     * authorization server.  The authorization code MUST expire
<A NAME="691"></A>     * shortly after it is issued to mitigate the risk of leaks.  A
<A NAME="692"></A>     * maximum authorization code lifetime of 10 minutes is
<A NAME="693"></A>     * RECOMMENDED.  The client MUST NOT use the authorization code
<A NAME="694"></A>     * more than once.  If an authorization code is used more than
<A NAME="695"></A>     * once, the authorization server MUST deny the request and SHOULD
<A NAME="696"></A>     * attempt to revoke all tokens previously issued based on that
<A NAME="697"></A>     * authorization code.  The authorization code is bound to the
<A NAME="698"></A>     * client identifier and redirection URI.
<A NAME="699"></A>     * state
<A NAME="700"></A>     * REQUIRED if the "state" parameter was present in the client
<A NAME="701"></A>     * authorization request.  The exact value received from the
<A NAME="702"></A>     * client.
<A NAME="703"></A>     * &lt;p/&gt;
<A NAME="704"></A>     * For example, the authorization server redirects the user-agent by
<A NAME="705"></A>     * sending the following HTTP response:
<A NAME="706"></A>     * &lt;p/&gt;
<A NAME="707"></A>     * &lt;p/&gt;
<A NAME="708"></A>     * HTTP/1.1 302 Found
<A NAME="709"></A>     * Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA
<A NAME="710"></A>     * &amp;state=xyz
<A NAME="711"></A>     * &lt;p/&gt;
<A NAME="712"></A>     * &lt;p/&gt;
<A NAME="713"></A>     * The client SHOULD ignore unrecognized response parameters.  The
<A NAME="714"></A>     * authorization code string size is left undefined by this
<A NAME="715"></A>     * specification.  The client should avoid making assumptions about code
<A NAME="716"></A>     * value sizes.  The authorization server should document the size of
<A NAME="717"></A>     * any value it issues.
<A NAME="718"></A>     */</FONT>
<A NAME="719"></A>    @LOGIC(
<A NAME="720"></A>            @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="721"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> OAuthAuthorizationResponse {
<A NAME="722"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="723"></A></FONT>
<A NAME="724"></A>
<A NAME="725"></A>        <FONT ID="FormalComment">/**
<A NAME="726"></A>         * REQUIRED.  The authorization code generated by the
<A NAME="727"></A>         * authorization server.  The authorization code MUST expire
<A NAME="728"></A>         * shortly after it is issued to mitigate the risk of leaks.  A
<A NAME="729"></A>         * maximum authorization code lifetime of 10 minutes is
<A NAME="730"></A>         * RECOMMENDED.  The client MUST NOT use the authorization code
<A NAME="731"></A>         * more than once.  If an authorization code is used more than
<A NAME="732"></A>         * once, the authorization server MUST deny the request and SHOULD
<A NAME="733"></A>         * attempt to revoke all tokens previously issued based on that
<A NAME="734"></A>         * authorization code.  The authorization code is bound to the
<A NAME="735"></A>         * client identifier and redirection URI.
<A NAME="736"></A>         */</FONT>
<A NAME="737"></A>        <FONT ID="Final">final</FONT> String code;
<A NAME="738"></A>
<A NAME="739"></A>        <FONT ID="FormalComment">/**
<A NAME="740"></A>         * REQUIRED if the "state" parameter was present in the client
<A NAME="741"></A>         * authorization request.  The exact value received from the
<A NAME="742"></A>         * client.
<A NAME="743"></A>         */</FONT>
<A NAME="744"></A>        <FONT ID="Final">final</FONT> String state;
<A NAME="745"></A>
<A NAME="746"></A>        <FONT ID="Public">public</FONT> OAuthAuthorizationResponse(<FONT ID="Final">final</FONT> String code, <FONT ID="Final">final</FONT> String state) {
<A NAME="747"></A>            <FONT ID="This">this</FONT>.code = code != <FONT ID="Null">null</FONT> ? code : AbstractOAuth.EMPTY;
<A NAME="748"></A>            <FONT ID="This">this</FONT>.state = state != <FONT ID="Null">null</FONT> ? state : AbstractOAuth.EMPTY;
<A NAME="749"></A>        }
<A NAME="750"></A>
<A NAME="751"></A>        @Override
<A NAME="752"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="753"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"OAuthAuthorizationResponse{"</FONT> +
<A NAME="754"></A>                    <FONT ID="StringLiteral">"code='"</FONT> + code + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="755"></A>                    <FONT ID="StringLiteral">", state='"</FONT> + state + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="756"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="757"></A>        }
<A NAME="758"></A>    }
<A NAME="759"></A>
<A NAME="760"></A>    <FONT ID="FormalComment">/**
<A NAME="761"></A>     * The client makes a request to the token endpoint by adding the
<A NAME="762"></A>     * following parameters using the "application/x-www-form-urlencoded"
<A NAME="763"></A>     * format in the HTTP request entity-body:
<A NAME="764"></A>     * &lt;p/&gt;
<A NAME="765"></A>     * grant_type
<A NAME="766"></A>     * REQUIRED.  Value MUST be set to "authorization_code".
<A NAME="767"></A>     * code
<A NAME="768"></A>     * REQUIRED.  The authorization code received from the
<A NAME="769"></A>     * authorization server.
<A NAME="770"></A>     * redirect_uri
<A NAME="771"></A>     * REQUIRED, if the "redirect_uri" parameter was included in the
<A NAME="772"></A>     * authorization request as described in Section 4.1.1, and their
<A NAME="773"></A>     * values MUST be identical.
<A NAME="774"></A>     * &lt;p/&gt;
<A NAME="775"></A>     * If the client type is confidential or the client was issued client
<A NAME="776"></A>     * credentials (or assigned other authentication requirements), the
<A NAME="777"></A>     * client MUST authenticate with the authorization server as described
<A NAME="778"></A>     * in Section 3.2.1.
<A NAME="779"></A>     * &lt;p/&gt;
<A NAME="780"></A>     * For example, the client makes the following HTTP request using
<A NAME="781"></A>     * transport-layer security (extra line breaks are for display purposes
<A NAME="782"></A>     * only):
<A NAME="783"></A>     * &lt;p/&gt;
<A NAME="784"></A>     * &lt;p/&gt;
<A NAME="785"></A>     * POST /token HTTP/1.1
<A NAME="786"></A>     * Host: server.example.com
<A NAME="787"></A>     * Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
<A NAME="788"></A>     * Content-Type: application/x-www-form-urlencoded;charset=UTF-8
<A NAME="789"></A>     * &lt;p/&gt;
<A NAME="790"></A>     * grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA
<A NAME="791"></A>     * &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
<A NAME="792"></A>     */</FONT>
<A NAME="793"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> OAuthAccessTokenRequest {
<A NAME="794"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="795"></A></FONT>
<A NAME="796"></A>
<A NAME="797"></A>        <FONT ID="FormalComment">/**
<A NAME="798"></A>         * REQUIRED.  Value MUST be set to "authorization_code".
<A NAME="799"></A>         */</FONT>
<A NAME="800"></A>        <FONT ID="Final">final</FONT> String grant_type;
<A NAME="801"></A>
<A NAME="802"></A>        <FONT ID="FormalComment">/**
<A NAME="803"></A>         * REQUIRED.  The authorization code received from the
<A NAME="804"></A>         * authorization server.
<A NAME="805"></A>         */</FONT>
<A NAME="806"></A>        <FONT ID="Final">final</FONT> String code;
<A NAME="807"></A>
<A NAME="808"></A>        <FONT ID="FormalComment">/**
<A NAME="809"></A>         * REQUIRED, if the "redirect_uri" parameter was included in the
<A NAME="810"></A>         * authorization request as described in Section 4.1.1, and their
<A NAME="811"></A>         * values MUST be identical.
<A NAME="812"></A>         */</FONT>
<A NAME="813"></A>        <FONT ID="Final">final</FONT> String redirect_uri;
<A NAME="814"></A>
<A NAME="815"></A>        @LOGIC(
<A NAME="816"></A>                @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="817"></A>        <FONT ID="Public">public</FONT> OAuthAccessTokenRequest(<FONT ID="Final">final</FONT> String grant_type, <FONT ID="Final">final</FONT> String code, <FONT ID="Final">final</FONT> String redirect_uri) {
<A NAME="818"></A>            <FONT ID="This">this</FONT>.grant_type = grant_type != <FONT ID="Null">null</FONT> ? grant_type : AbstractOAuth.EMPTY;
<A NAME="819"></A>            <FONT ID="This">this</FONT>.code = code != <FONT ID="Null">null</FONT> ? code : AbstractOAuth.EMPTY;
<A NAME="820"></A>            <FONT ID="This">this</FONT>.redirect_uri = redirect_uri != <FONT ID="Null">null</FONT> ? redirect_uri : AbstractOAuth.EMPTY;
<A NAME="821"></A>        }
<A NAME="822"></A>
<A NAME="823"></A>        @Override
<A NAME="824"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="825"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"OAuthAccessTokenRequest{"</FONT> +
<A NAME="826"></A>                    <FONT ID="StringLiteral">"grant_type='"</FONT> + grant_type + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="827"></A>                    <FONT ID="StringLiteral">", code='"</FONT> + code + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="828"></A>                    <FONT ID="StringLiteral">", redirect_uri='"</FONT> + redirect_uri + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="829"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="830"></A>        }
<A NAME="831"></A>    }
<A NAME="832"></A>
<A NAME="833"></A>    <FONT ID="FormalComment">/**
<A NAME="834"></A>     * If the access token request is valid and authorized, the
<A NAME="835"></A>     * authorization server issues an access token and optional refresh
<A NAME="836"></A>     * token as described in Section 5.1.  If the request client
<A NAME="837"></A>     * authentication failed or is invalid, the authorization server returns
<A NAME="838"></A>     * an error response as described in Section 5.2.
<A NAME="839"></A>     * &lt;p/&gt;
<A NAME="840"></A>     * An example successful response:
<A NAME="841"></A>     * &lt;p/&gt;
<A NAME="842"></A>     * &lt;p/&gt;
<A NAME="843"></A>     * HTTP/1.1 200 OK
<A NAME="844"></A>     * Content-Type: application/json;charset=UTF-8
<A NAME="845"></A>     * Cache-Control: no-store
<A NAME="846"></A>     * Pragma: no-cache
<A NAME="847"></A>     * &lt;p/&gt;
<A NAME="848"></A>     * {
<A NAME="849"></A>     * "access_token":"2YotnFZFEjr1zCsicMWpAA",
<A NAME="850"></A>     * "token_type":"example",
<A NAME="851"></A>     * "expires_in":3600,
<A NAME="852"></A>     * "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA",
<A NAME="853"></A>     * "example_parameter":"example_value"
<A NAME="854"></A>     * }
<A NAME="855"></A>     *
<A NAME="856"></A>     * @see &lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-05#section-3.3.2&lt;/a&gt;
<A NAME="857"></A>     */</FONT>
<A NAME="858"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> OAuthAccessTokenResponse {
<A NAME="859"></A><FONT ID="SingleLineComment">// ------------------------------ FIELDS (NON-STATIC)--------------------
<A NAME="860"></A></FONT>
<A NAME="861"></A>
<A NAME="862"></A>        <FONT ID="FormalComment">/**
<A NAME="863"></A>         * REQUIRED.  The access token issued by the authorization server.
<A NAME="864"></A>         */</FONT>
<A NAME="865"></A>        <FONT ID="Final">final</FONT> String access_token;
<A NAME="866"></A>
<A NAME="867"></A>        <FONT ID="FormalComment">/**
<A NAME="868"></A>         * REQUIRED.  The type of the token issued as described in Section 7.1.  Value is case insensitive.
<A NAME="869"></A>         */</FONT>
<A NAME="870"></A>        <FONT ID="Final">final</FONT> String token_type;
<A NAME="871"></A>
<A NAME="872"></A>        <FONT ID="FormalComment">/**
<A NAME="873"></A>         * OPTIONAL.  The lifetime in seconds of the access token.  For
<A NAME="874"></A>         * example, the value "3600" denotes that the access token will
<A NAME="875"></A>         * expire in one hour from the time the response was generated.
<A NAME="876"></A>         */</FONT>
<A NAME="877"></A>        <FONT ID="Final">final</FONT> String expires_in;
<A NAME="878"></A>        <FONT ID="FormalComment">/**
<A NAME="879"></A>         * OPTIONAL.  The refresh token which can be used to obtain new
<A NAME="880"></A>         * access tokens using the same authorization grant as described
<A NAME="881"></A>         * in Section 6.
<A NAME="882"></A>         */</FONT>
<A NAME="883"></A>        <FONT ID="Final">final</FONT> String refresh_token;
<A NAME="884"></A>
<A NAME="885"></A>        <FONT ID="FormalComment">/**
<A NAME="886"></A>         * OPTIONAL.  The scope of the access token as described by
<A NAME="887"></A>         */</FONT>
<A NAME="888"></A>        <FONT ID="Final">final</FONT> String parameters;
<A NAME="889"></A>
<A NAME="890"></A>        @LOGIC(
<A NAME="891"></A>                @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="892"></A>        <FONT ID="Public">public</FONT> OAuthAccessTokenResponse(<FONT ID="Final">final</FONT> String access_token,
<A NAME="893"></A>                                        <FONT ID="Final">final</FONT> String token_type,
<A NAME="894"></A>                                        <FONT ID="Final">final</FONT> String expires_in,
<A NAME="895"></A>                                        <FONT ID="Final">final</FONT> String refresh_token,
<A NAME="896"></A>                                        <FONT ID="Final">final</FONT> String parameters) {
<A NAME="897"></A>            <FONT ID="This">this</FONT>.access_token = access_token != <FONT ID="Null">null</FONT> ? access_token : AbstractOAuth.EMPTY;
<A NAME="898"></A>            <FONT ID="This">this</FONT>.token_type = token_type != <FONT ID="Null">null</FONT> ? token_type : AbstractOAuth.EMPTY;
<A NAME="899"></A>            <FONT ID="This">this</FONT>.expires_in = expires_in != <FONT ID="Null">null</FONT> ? expires_in : AbstractOAuth.EMPTY;
<A NAME="900"></A>            <FONT ID="This">this</FONT>.refresh_token = refresh_token != <FONT ID="Null">null</FONT> ? refresh_token : AbstractOAuth.EMPTY;
<A NAME="901"></A>            <FONT ID="This">this</FONT>.parameters = parameters != <FONT ID="Null">null</FONT> ? parameters : AbstractOAuth.EMPTY;
<A NAME="902"></A>        }
<A NAME="903"></A>
<A NAME="904"></A>        @Override
<A NAME="905"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="906"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"OAuthAccessTokenResponse{"</FONT> +
<A NAME="907"></A>                    <FONT ID="StringLiteral">"access_token='"</FONT> + access_token + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="908"></A>                    <FONT ID="StringLiteral">", token_type='"</FONT> + token_type + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="909"></A>                    <FONT ID="StringLiteral">", expires_in='"</FONT> + expires_in + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="910"></A>                    <FONT ID="StringLiteral">", refresh_token='"</FONT> + refresh_token + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="911"></A>                    <FONT ID="StringLiteral">", parameters='"</FONT> + parameters + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="912"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="913"></A>        }
<A NAME="914"></A>    }
<A NAME="915"></A>
<A NAME="916"></A>    <FONT ID="FormalComment">/**
<A NAME="917"></A>     * Alternatively, the authorization server MAY allow including the
<A NAME="918"></A>     * client credentials in the request body using the following
<A NAME="919"></A>     * parameters:
<A NAME="920"></A>     * &lt;p/&gt;
<A NAME="921"></A>     * client_id
<A NAME="922"></A>     * REQUIRED.  The client identifier issued to the client during
<A NAME="923"></A>     * the registration process described by Section 2.2.
<A NAME="924"></A>     * client_secret
<A NAME="925"></A>     * REQUIRED.  The client secret.  The client MAY omit the
<A NAME="926"></A>     * parameter if the client secret is an empty string.
<A NAME="927"></A>     * &lt;p/&gt;
<A NAME="928"></A>     * Including the client credentials in the request body using the two
<A NAME="929"></A>     * parameters is NOT RECOMMENDED, and should be limited to clients
<A NAME="930"></A>     * unable to directly utilize the HTTP Basic authentication scheme (or
<A NAME="931"></A>     * other password-based HTTP authentication schemes).
<A NAME="932"></A>     * &lt;p/&gt;
<A NAME="933"></A>     * For example, requesting to refresh an access token (Section 6) using
<A NAME="934"></A>     * the body parameters (extra line breaks are for display purposes
<A NAME="935"></A>     * only):
<A NAME="936"></A>     * &lt;p/&gt;
<A NAME="937"></A>     * &lt;p/&gt;
<A NAME="938"></A>     * POST /token HTTP/1.1
<A NAME="939"></A>     * Host: server.example.com
<A NAME="940"></A>     * Content-Type: application/x-www-form-urlencoded;charset=UTF-8
<A NAME="941"></A>     * &lt;p/&gt;
<A NAME="942"></A>     * grant_type=refresh_token&amp;refresh_token=tGzv3JOkF0XG5Qx2TlKWIA
<A NAME="943"></A>     * &amp;client_id=s6BhdRkqt3&amp;client_secret=7Fjfp0ZBr1KtDRbnfVdmIw
<A NAME="944"></A>     * &lt;p/&gt;
<A NAME="945"></A>     * &lt;p/&gt;
<A NAME="946"></A>     * The authorization server MUST require the use of a transport-layer
<A NAME="947"></A>     * security mechanism when sending requests to the token endpoint, as
<A NAME="948"></A>     * requests using this authentication method result in the transmission
<A NAME="949"></A>     * of clear-text credentials.
<A NAME="950"></A>     * &lt;p/&gt;
<A NAME="951"></A>     * Since this client authentication method involves a password, the
<A NAME="952"></A>     * authorization server MUST protect any endpoint utilizing it against
<A NAME="953"></A>     * brute force attacks.
<A NAME="954"></A>     */</FONT>
<A NAME="955"></A>    <FONT ID="Public">public</FONT> <FONT ID="Final">final</FONT> <FONT ID="Class">class</FONT> ClientAuthentication {
<A NAME="956"></A>        <FONT ID="FormalComment">/**
<A NAME="957"></A>         * REQUIRED.  The client identifier issued to the client during
<A NAME="958"></A>         * the registration process described by Section 2.2.
<A NAME="959"></A>         */</FONT>
<A NAME="960"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> String client_id;
<A NAME="961"></A>        <FONT ID="FormalComment">/**
<A NAME="962"></A>         * REQUIRED.  The client secret.  The client MAY omit the
<A NAME="963"></A>         * parameter if the client secret is an empty string.
<A NAME="964"></A>         */</FONT>
<A NAME="965"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> String client_secret;
<A NAME="966"></A>
<A NAME="967"></A>        <FONT ID="Final">final</FONT> <FONT ID="Public">public</FONT> String redirect_uri;
<A NAME="968"></A>
<A NAME="969"></A>
<A NAME="970"></A>        @LOGIC(
<A NAME="971"></A>                @NOTE(<FONT ID="StringLiteral">"By nature, we don't want this object to be modified after construction."</FONT>))
<A NAME="972"></A>        <FONT ID="Public">public</FONT> ClientAuthentication(<FONT ID="Final">final</FONT> String client_id, <FONT ID="Final">final</FONT> String client_secret, <FONT ID="Final">final</FONT> String redirect_uri) {
<A NAME="973"></A>            <FONT ID="This">this</FONT>.client_id = client_id;
<A NAME="974"></A>            <FONT ID="This">this</FONT>.client_secret = client_secret;
<A NAME="975"></A>            <FONT ID="This">this</FONT>.redirect_uri = redirect_uri;
<A NAME="976"></A>        }
<A NAME="977"></A>
<A NAME="978"></A>        @Override
<A NAME="979"></A>        <FONT ID="Public">public</FONT> String toString() {
<A NAME="980"></A>            <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"ClientAuthentication{"</FONT> +
<A NAME="981"></A>                    <FONT ID="StringLiteral">"client_id='"</FONT> + client_id + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="982"></A>                    <FONT ID="StringLiteral">", client_secret='"</FONT> + client_secret + <FONT ID="CharacerLiteral">'\''</FONT> +
<A NAME="983"></A>                    <FONT ID="CharacerLiteral">'}'</FONT>;
<A NAME="984"></A>        }
<A NAME="985"></A>    }
<A NAME="986"></A>
<A NAME="987"></A><FONT ID="SingleLineComment">// ------------------------ OVERRIDING METHODS ------------------------
<A NAME="988"></A></FONT>
<A NAME="989"></A>    <FONT ID="FormalComment">/**
<A NAME="990"></A>     * Handles the HTTP &lt;code&gt;GET&lt;/code&gt; method.
<A NAME="991"></A>     *
<A NAME="992"></A>     * @param request  servlet request
<A NAME="993"></A>     * @param response servlet response
<A NAME="994"></A>     * @throws javax.servlet.ServletException if a servlet-specific error occurs
<A NAME="995"></A>     * @throws java.io.IOException            if an I/O error occurs
<A NAME="996"></A>     */</FONT>
<A NAME="997"></A>    @Override
<A NAME="998"></A>    <FONT ID="Protected">protected</FONT> <FONT ID="Void">void</FONT> doGet(<FONT ID="Final">final</FONT> HttpServletRequest request, <FONT ID="Final">final</FONT> HttpServletResponse response)
<A NAME="999"></A>            <FONT ID="Throws">throws</FONT> ServletException, IOException {
<A NAME="1000"></A>        <FONT ID="Final">final</FONT> String ilp_destination_value = request.getParameter(ILP_DESTINATION); <FONT ID="SingleLineComment">//Using ilp prefix incase it clashes with OAuth
<A NAME="1001"></A></FONT>
<A NAME="1002"></A>        <FONT ID="If">if</FONT> (ilp_destination_value != <FONT ID="Null">null</FONT> &amp;&amp; !ilp_destination_value.isEmpty()) {
<A NAME="1003"></A>            <FONT ID="If">if</FONT> (request.getSession(<FONT ID="True">true</FONT>).getAttribute(ILP_DESTINATION) == <FONT ID="Null">null</FONT>) {
<A NAME="1004"></A>                request.getSession().setAttribute(ILP_DESTINATION, ilp_destination_value);
<A NAME="1005"></A>            }
<A NAME="1006"></A>        } <FONT ID="Else">else</FONT> {<FONT ID="SingleLineComment">//tricky. we need to get refer but do this just once to avoid refer being updated with internal urls upon consecutive calls
<A NAME="1007"></A></FONT>            <FONT ID="If">if</FONT> (request.getSession(<FONT ID="True">true</FONT>).getAttribute(ILP_DESTINATION) == <FONT ID="Null">null</FONT>) {<FONT ID="SingleLineComment">//checking if previous calls set refer in session
<A NAME="1008"></A></FONT>                request.getSession().setAttribute(ILP_DESTINATION,  request.getHeader(ServletLogin.HEADER_REFERER));
<A NAME="1009"></A>            }
<A NAME="1010"></A>        }
<A NAME="1011"></A>
<A NAME="1012"></A>        processRequest(request, response);
<A NAME="1013"></A>    }
<A NAME="1014"></A>
<A NAME="1015"></A>    <FONT ID="FormalComment">/**
<A NAME="1016"></A>     * This generally is called with code and state, as a redirect from the OAuth vendor.
<A NAME="1017"></A>     * &lt;p/&gt;
<A NAME="1018"></A>     * &lt;p/&gt;
<A NAME="1019"></A>     * Below is a redirect from FB.
<A NAME="1020"></A>     * &lt;p/&gt;
<A NAME="1021"></A>     * &lt;p/&gt;
<A NAME="1022"></A>     * e.g. http://www.ilikeplaces.com/oauth2?code=AQC3Zblablablabla9uO8MN_miEUIlZvMWNNblabla6zOyblablafCwDFYMli5zdblabla0peBblablaINKIDw#_=_
<A NAME="1023"></A>     * &lt;p/&gt;
<A NAME="1024"></A>     * &lt;p/&gt;
<A NAME="1025"></A>     * Note that the REQUIRED "state" parameter is missing.
<A NAME="1026"></A>     * &lt;p/&gt;
<A NAME="1027"></A>     * &lt;p/&gt;
<A NAME="1028"></A>     * Generally, if "code" is missing, which will never be missing, we will send the user to the {@link #oAuthEndpoint OAuth Endpoint}
<A NAME="1029"></A>     * with the non-null parameters specified in {@link #oAuthAuthorizationRequest}.
<A NAME="1030"></A>     * &lt;p/&gt;
<A NAME="1031"></A>     * &lt;p/&gt;
<A NAME="1032"></A>     * &lt;b&gt;code&lt;/b&gt;
<A NAME="1033"></A>     * &lt;p/&gt;
<A NAME="1034"></A>     * REQUIRED.  The authorization code generated by the
<A NAME="1035"></A>     * authorization server.  The authorization code MUST expire
<A NAME="1036"></A>     * shortly after it is issued to mitigate the risk of leaks.  A
<A NAME="1037"></A>     * maximum authorization code lifetime of 10 minutes is
<A NAME="1038"></A>     * RECOMMENDED.  The client MUST NOT use the authorization code
<A NAME="1039"></A>     * more than once.  If an authorization code is used more than
<A NAME="1040"></A>     * once, the authorization server MUST deny the request and SHOULD
<A NAME="1041"></A>     * attempt to revoke all tokens previously issued based on that
<A NAME="1042"></A>     * authorization code.  The authorization code is bound to the
<A NAME="1043"></A>     * client identifier and redirection URI.
<A NAME="1044"></A>     * &lt;p/&gt;
<A NAME="1045"></A>     * &lt;b&gt;state&lt;/b&gt;
<A NAME="1046"></A>     * &lt;p/&gt;
<A NAME="1047"></A>     * REQUIRED if the "state" parameter was present in the client
<A NAME="1048"></A>     * authorization request.  The exact value received from the
<A NAME="1049"></A>     *
<A NAME="1050"></A>     * @param request
<A NAME="1051"></A>     * @param response
<A NAME="1052"></A>     */</FONT>
<A NAME="1053"></A>    @LOGIC(
<A NAME="1054"></A>            @NOTE(
<A NAME="1055"></A>                    <FONT ID="StringLiteral">"As of now, this method is where we get a redirect from the OAuth server with the related data below: (&lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-22#section-4.1.2'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-22#section-4.1.2&lt;/a&gt; "</FONT> +
<A NAME="1056"></A>                            <FONT ID="StringLiteral">"   code\n"</FONT> +
<A NAME="1057"></A>                            <FONT ID="StringLiteral">"         REQUIRED.  The authorization code generated by the\n"</FONT> +
<A NAME="1058"></A>                            <FONT ID="StringLiteral">"         authorization server.  The authorization code MUST expire\n"</FONT> +
<A NAME="1059"></A>                            <FONT ID="StringLiteral">"         shortly after it is issued to mitigate the risk of leaks.  A\n"</FONT> +
<A NAME="1060"></A>                            <FONT ID="StringLiteral">"         maximum authorization code lifetime of 10 minutes is\n"</FONT> +
<A NAME="1061"></A>                            <FONT ID="StringLiteral">"         RECOMMENDED.  The client MUST NOT use the authorization code\n"</FONT> +
<A NAME="1062"></A>                            <FONT ID="StringLiteral">"         more than once.  If an authorization code is used more than\n"</FONT> +
<A NAME="1063"></A>                            <FONT ID="StringLiteral">"         once, the authorization server MUST deny the request and SHOULD\n"</FONT> +
<A NAME="1064"></A>                            <FONT ID="StringLiteral">"         attempt to revoke all tokens previously issued based on that\n"</FONT> +
<A NAME="1065"></A>                            <FONT ID="StringLiteral">"         authorization code.  The authorization code is bound to the\n"</FONT> +
<A NAME="1066"></A>                            <FONT ID="StringLiteral">"         client identifier and redirection URI.\n"</FONT> +
<A NAME="1067"></A>                            <FONT ID="StringLiteral">"   state\n"</FONT> +
<A NAME="1068"></A>                            <FONT ID="StringLiteral">"         REQUIRED if the \"state\" parameter was present in the client\n"</FONT> +
<A NAME="1069"></A>                            <FONT ID="StringLiteral">"         authorization request.  The exact value received from the"</FONT>))
<A NAME="1070"></A>    <FONT ID="Abstract">abstract</FONT> <FONT ID="Void">void</FONT> processRequest(<FONT ID="Final">final</FONT> HttpServletRequest request, <FONT ID="Final">final</FONT> HttpServletResponse response);
<A NAME="1071"></A>
<A NAME="1072"></A>    <FONT ID="FormalComment">/**
<A NAME="1073"></A>     * Handles the HTTP &lt;code&gt;POST&lt;/code&gt; method.
<A NAME="1074"></A>     *
<A NAME="1075"></A>     * @param request  servlet request
<A NAME="1076"></A>     * @param response servlet response
<A NAME="1077"></A>     * @throws ServletException if a servlet-specific error occurs
<A NAME="1078"></A>     * @throws IOException      if an I/O error occurs
<A NAME="1079"></A>     */</FONT>
<A NAME="1080"></A>    @Override
<A NAME="1081"></A>    <FONT ID="Protected">protected</FONT> <FONT ID="Void">void</FONT> doPost(<FONT ID="Final">final</FONT> HttpServletRequest request, <FONT ID="Final">final</FONT> HttpServletResponse response)
<A NAME="1082"></A>            <FONT ID="Throws">throws</FONT> ServletException, IOException {
<A NAME="1083"></A>        processRequest(request, response);
<A NAME="1084"></A>    }
<A NAME="1085"></A>}
<A NAME="1086"></A></pre>
</BODY>
</HTML>