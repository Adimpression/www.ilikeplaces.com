<!--
  ~ @License(content = "This code is licensed under GNU AFFERO GENERAL PUBLIC LICENSE Version 3")
  -->

<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:itsnat="http://itsnat.org/itsnat" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ai\ilikeplaces\widgets\Juice.xhtml</title>
</head>
<body>
<div class="use100 center" id="Juice" style="height:100%;" itsnat:nocache="true"
     xmlns:itsnat="http://itsnat.org/itsnat">
<div class="use100"
     style="height: 100%;background:url('/images/home.jpeg') no-repeat center center fixed;-webkit-background-size: cover;-moz-background-size: cover;-o-background-size: cover;background-size: cover; ">

    <div class="use100" style="height:19%;">
        <div class="use19 juice" id="Juice_Talk" style="height:100%;">
            <div class="use100" style="height:100%;">
                &nbsp;
            </div>
        </div>
        <div class="use62 juice" id="Juice_Talk_Content" style="height:100%;">
            <div class="use100" style="height:100%;">
                <div class="use100 rise100">
                    &nbsp;
                </div>
            </div>
        </div>
        <div class="use19 juice" id="Juice_Tribe" style="height:100%;">
            <div class="use100" style="height:100%;">
                &nbsp;
            </div>
        </div>
    </div>
    <div class="use100 juice" style="height:62%; overflow: hidden;">
        <div class="use19" id="Juice_Snap_Content" style="height:100%;">
            <div class="use100" style="height:100%;">
                <div class="use100 rise100 overflow_hidden">
                    &nbsp;
                </div>
            </div>
        </div>
        <div class="use62" id="Juice_Content"
             style="height:100%;padding: 10px;background:url('/images/Metal_translucent_dull.png') repeat;">
            <div class="use90 use5p use5a"
                 style="height:100%;background:url('/images/Metal_translucent_dull.png') repeat;">
                <div class="use100" id="Juice_Noti"
                     style="font-size:30px;font-family:'Comic Sans MS',serif;color:#00eeee;">
                </div>
                <div class="use100" style="height:35%; vertical-align: middle;">
                    <div class="use90" style="vertical-align: middle;">
                        <img src="/images/find_fun_around_you.png"
                             style="padding-top: 90px;"
                             onclick="suggestPlace();$('.JSJuicePlaceInput').focus();"
                             alt="Find exciting stuff around you" class="use100 cursor_pointer"/>
                    </div>
                    `
                </div>
                <div class="use100 hidden" id="jsSignupBox" style="height:35%;">
                    <div class="use100" style="height:20%;">
                        <div class="use20 use5p right" style="height:100%;vertical-align: top;">
                            <img src="/images/Sign_up_Email.png" alt="Sign Up Email"
                                 class="rise100 right cursor_pointer"
                                 onclick="$('.Juice_Email').focus();"/>
                        </div>
                        <div class="use40 use5p" style="height:100%;">
                            <input type="text"
                                   id="Juice_Email"
                                   style="height:100%;font-family:'Comic Sans MS',serif;color:#f928c7;text-align:center;border:1px solid #46a1ff;background:url('/images/Metal_translucent.png') repeat;font-size:25px;"
                                   class="use100 Juice_Email"/>
                        </div>
                        <div class="use20 use5p use5a left" style="height:100%;">
                            <img id="Juice_Signup_Click" class="rise100 left" src="/images/Sign_up_Do.png" alt="Sign up"
                                 style="cursor:pointer;"/>
                        </div>
                    </div>
                    <div class="use100" style="height:20%; overflow:hidden;">
                        <div class="use60 use20p use20a">
                            <img src="/images/Sign_up_Or.png" alt="Or" class="use40 use30p use30a"/>
                        </div>
                    </div>
                    <div class="use80 use10p use10a" style="height:40%;">
                        <div class="use25 use20p use5a">
                            <img src="/images/Sign_up_3rd_Google.png" alt="" class="use100" style="cursor:pointer;"
                                 onclick="$('body').hide();window.location.href='/oauth2gg?state=login';"/>
                        </div>
                        <div class="use25 use20a use5p">
                            <img src="/images/Sign_up_3rd_Facebook.png" alt="" class="use100" style="cursor:pointer;"
                                 onclick="$('body').hide();window.location.href='/oauth2fb';"/>
                        </div>
                    </div>
                </div>
                <div class="use100" id="jsSignupFiller" style="height:35%;">
                    <div class="use90 use5p use5a" style="height:20%;display: block;">
                        &nbsp;
                    </div>
                    <div class="use100" style="height:80%;">
                        <div class="use19">
                            <div class="use100">
                                <img class="use100 cursor_pointer"
                                     src="/images/i_am_in.png"
                                     onclick="suggestPlace();"
                                     alt="I'm in"/>
                            </div>
                        </div>
                        <div class="use62">
                            <div class="use90 use5p use5a">
                                <input type="text"
                                       value=""
                                       title="You need to enter a place|Click search|You will be redirected to map"
                                       id="Juice_Place_Input"
                                       style="height:100%;font-family:'Comic Sans MS',serif;color:#0372d9;text-align:center;
                                                border: 0 #0372d9 dotted;border-bottom-width: 5px;
                                                background:url('/images/Metal_translucent.png') repeat;font-size:31px;"
                                       class="use80 use10p use10a vtip JSJuicePlaceInput"
                                       onclick="if(wasPlaceSearchBoxClickedOnce()) {suggestPlace();} placeSearchBoxClicked = true;"
                                        />
                            </div>
                        </div>
                        <div class="use19">
                            <div class="use100">
                                <img src="/images/Search.png"
                                     title="You need to enter a place|Click search|You will be redirected to map"
                                     id="Juice_Place_Submit"
                                     alt="" class="use100 vtip click_indicator JSJuicePlaceSubmit"
                                     style="overflow: hidden; cursor: pointer;"
                                     onclick="if($('.JSJuicePlaceInput').val() == ''){suggestPlace();} $('#AarrrJuice').fadeOut();$('#AarrrDownTownHeatMap').fadeIn();google.maps.event.trigger(GAIA, 'resize');$('#searchboxmap').attr('value',$('.JSJuicePlaceInput').val()).text($('.JSJuicePlaceInput').val());$('#searchButtonMap').click();"
                                        />
                            </div>
                            <div class="use100" style="height: 20px;">
                                &nbsp;
                            </div>
                        </div>
                    </div>
                </div>
                <div class="use80 use10p use10a cursor_pointer" style="height:10%;">
                    <img class="use100 vtip" alt="Get Updates!" src="/images/get_updates.png"
                         title="You need to enter a place|Click Get Updates|You will be emailed updates"
                         id="Juice_Get_Updates"
                         onclick="setMapToLocation($('.JSJuicePlaceInput').val());$('.AarrrSubscribe').show();$('.AarrrDownTownHeatMap').hide();$('.AarrrJuice').hide();"/>
                </div>
                <div class="use100" style="height: 20%;">
                    &nbsp;
                </div>
            </div>
        </div>
        <div class="use19 juice" id="Juice_Tribe_Content" style="height:100%;">
            <div class="use100" style="height:100%;">
                <div class="use100 rise100 overflow_hidden">
                    &nbsp;
                </div>
            </div>
        </div>
    </div>
    <div class="use100" style="height:19%;">
        <div class="use19 juice" id="Juice_Snap" style="height:100%;">
            <div class="use100" style="height:100%;">
                &nbsp;
            </div>
        </div>
        <div class="use62 juice" id="Juice_Moment_Content" style="height:100%;">
            <div class="use100" style="height:100%;">
                <div class="use100 rise100">
                    &nbsp;
                </div>
            </div>
        </div>
        <div class="use19 juice" id="Juice_Moment" style="height:100%;">
            <div class="use100 " style="height:100%;">
                &nbsp;
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var placeSearchBoxClicked = false;

    function wasPlaceSearchBoxClickedOnce() {
        return placeSearchBoxClicked;
    }

    function suggestPlace() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (location) {
                var googleLatLong = new google.maps.LatLng(location.coords.latitude, location.coords.longitude);
                $('#AarrrWOEID').val(location.coords.latitude + "," + location.coords.longitude + "," + location.coords.latitude + "," + location.coords.longitude);
                generalCallOnDownTownHeatMapBBUpdate(location.coords.latitude, location.coords.longitude, location.coords.latitude, location.coords.longitude);
                getAddress(
                        googleLatLong,
                        function (desc) {
                            $("#searchboxmap").val(desc).text(desc);
                            $(".JSJuicePlaceInput").val(desc).text(desc);
                        }
                );
            });
        } else {
            try {//Attempting to geo locate the user based on ip
                // Build the URL to query
                var url = 'http://www.geoplugin.net/json.gp?jsoncallback=?';
                // Utilize the JSONP API
                $.getJSON(url, function (data) {
                    focusLng = data.geoplugin_longitude;
                    focusLat = data.geoplugin_latitude;
                    zoom = data.geoplugin_city != null ? 11 : (data.geoplugin_region != null ? 9 : (data.geoplugin_countryName ? 6 : 2 ) );
                    browserLocation = (data.geoplugin_city != null ? data.geoplugin_city + ',' : '')
                            + (data.geoplugin_region != null ? data.geoplugin_region + ',' : '')
                            + (data.geoplugin_countryName != null ? data.geoplugin_countryName : '');
                    $("#searchboxmap").val(browserLocation).text(browserLocation);
                    $(".JSJuicePlaceInput").val(browserLocation).text(browserLocation);
                    $('#AarrrWOEID').val(data.geoplugin_latitude + "," + data.geoplugin_longitude + "," + data.geoplugin_latitude + "," + data.geoplugin_longitude);
                    generalCallOnDownTownHeatMapBBUpdate(data.geoplugin_latitude, data.geoplugin_longitude, data.geoplugin_latitude, data.geoplugin_longitude);
                });
            } catch (err) {
            }
        }

    }

    $('.JSJuicePlaceInput').delay(500).focus();

    $('.JSJuicePlaceInput').keydown(function (e) {
        if (e.keyCode == 13) {
            $('.JSJuicePlaceSubmit').click();
        }
    });


    function generalCallOnDownTownHeatMapBBUpdate(latSW, lngSW, latNE, lngNE) {
        var curr = DownTownHeatMapBBUpdate(
                latSW,
                lngSW,
                latNE,
                lngNE
        );
        clearHotSpots();
        $('.AarrrDownTownHeatMap').show();//focus/blur will not work if not
        curr.focus();//To update ItsNat
        curr.blur();//To update ItsNat
        $('.AarrrDownTownHeatMap').hide();//focus/blur will not work if not
    }

    try {//Attempting to geo locate the user based on ip
        // Build the URL to query
        var url = 'http://www.geoplugin.net/json.gp?jsoncallback=?';
        // Utilize the JSONP API
        $.getJSON(url, function (data) {
            focusLng = data.geoplugin_longitude;
            focusLat = data.geoplugin_latitude;
            zoom = data.geoplugin_city != null ? 11 : (data.geoplugin_region != null ? 9 : (data.geoplugin_countryName ? 6 : 2 ) );
            browserLocation = (data.geoplugin_city != null ? data.geoplugin_city + ',' : '')
                    + (data.geoplugin_region != null ? data.geoplugin_region + ',' : '')
                    + (data.geoplugin_countryName != null ? data.geoplugin_countryName : '');
            $("#searchboxmap").val(browserLocation).text(browserLocation);
            $(".JSJuicePlaceInput").val(browserLocation).text(browserLocation);
            $('#AarrrWOEID').val(data.geoplugin_latitude + "," + data.geoplugin_longitude + "," + data.geoplugin_latitude + "," + data.geoplugin_longitude);
            generalCallOnDownTownHeatMapBBUpdate(data.geoplugin_latitude, data.geoplugin_longitude, data.geoplugin_latitude, data.geoplugin_longitude);
        });
    } catch (err) {
    }
</script>
</div>
</body>
</html>
